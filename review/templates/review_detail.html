{% extends "base.html" %}
{% load static %}

{% load crispy_forms_tags %}

{% block content %}
<section>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 col-md-6 col-lg-6 offset-lg-1"> 
                <h3 class="card-title my-5 text-center font-weight-bold">{{ expedition.title }}</h3>  
                <div class="my-3">
                    <img src="{{ expedition.travel_image.url }}" alt="" class="card-img-top image-detail rounded-2">
                </div>
                <div class="card-footer text-center">
                    <small class="font-weight-bold">Published: {{ expedition.published }} - By: {{ expedition.author }}</small>
                </div>
                <hr>
                <div class="text-center font-weight-bold p-2">
                    {{ expedition.excerpt }}
                </div>
                <div class="card-body text-center">
                    <p class="card-text p-2"> Rating:
                    <span class="fa fa-star {% if expedition.ratings > 0 %} checked {% endif %}"></span>
                    <span class="fa fa-star {% if expedition.ratings > 1 %} checked {% endif %}"></span>
                    <span class="fa fa-star {% if expedition.ratings > 2 %} checked {% endif %}"></span>
                    <span class="fa fa-star {% if expedition.ratings > 3 %} checked {% endif %}"></span>
                    <span class="fa fa-star {% if expedition.ratings > 4 %} checked {% endif %}"></span>
                    </p>
                </div>
                <div class="text-center m-2">
                    <a href="{% url 'review_list' %}">
                        <button type="button" class="btn btn-submit">Back to Expeditions</button>
                    </a>
                </div>
                <hr>
                <div class="text-center p-2">
                    {% if user.is_authenticated %}
                    <form action="{% url 'review_like' expedition.id %}" method="POST">
                        {% csrf_token %}
                        {% if liked %}
                        <span class="font-weight-bold pr-2">Unlike this Review!</span>
                        <button type="submit" name="review_id" value="{{ expedition.id }}" class="btn-like"><i class="fas fa-heart"></i></button>
                        <strong>{{ expedition.no_of_likes }} likes</strong>
                        {% else %}
                        <span class="font-weight-bold pr-2">Like this Review!</span>
                        <button type="submit" name="review_id" value="{{ expedition.id }}" class="btn-like"><i class="far fa-heart"></i></button>
                        <strong>{{ expedition.no_of_likes }} likes</strong>
                        {% endif %}
                    </form>
                    {% else %}
                    <span class="font-weight-bold pr-2"><a href="{% url 'account_login' %}">Sign In</a> to Like this Review!</span>
                    <span><i class="far fa-heart likes"></i></span>
                    <strong>{{ expedition.no_of_likes }} likes</strong>
                    {% endif %}
                </div>
                <div class="text-center pt-3">
                    {% if user.is_authenticated %}
                    {% with comments.count as total_comments %}
                    <span class="font-weight-bold pr-2">Leave a Comment Below!</span>
                    <strong><i class="far fa-comments comments"></i>              
                    {{ total_comments }} comments</strong>
                    {% endwith %}
                    {% else %}
                    {% with comments.count as total_comments %}
                    <span class="font-weight-bold pr-2"><a href="{% url 'account_login' %}">Sign In</a> to Leave a Comment Below!</span>
                    <strong><i class="far fa-comments comments"></i>              
                    {{ total_comments }} comments</strong>
                    {% endwith %}
                    {% endif %}
                </div>
                <hr>
                {% if user.is_authenticated %}
                    {% if user.id == expedition.author.id %}          
                        <div class="text-center pt-5">
                            <a href="{% url 'edit_review' expedition.id %}" class="btn btn-warning">Edit Review</a>
                            <a href="{% url 'delete_review' expedition.id %}" class="btn btn-danger">Delete Review</a>
                        </div>
                    {% endif %}
                {% endif %}                 
            </div>
            <div class="col-12 col-md-6 col-lg-4">
                <div class="review-content">
                    <h4 class="font-weight-bold">Expedition Review:</h4>
                    <p>{{ expedition.content }}</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8 card m-3 p-3">
                <div class="card-body">
                    <h3 class="font-weight-bold">Comments:</h3>
                    {% if not expedition.comments.all %}
                        No Comments Posted Yet...
                    {% else %}
                        {% for comment in comments %}
                        <div class="p-2">
                            <strong class="font-weight-bold"> 
                                {{ comment.name }} - 
                                {{ comment.created_on }}
                            </strong>
                            <br/>
                            {{ comment.body }}
                            <br/><br/>
                            <hr>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
            <div class="col-md-8 card m-3 p-4">
                <div>
                    {% if user.is_authenticated %}
                    <h3>Leave a comment</h3>
                    <p>Posting as: {{ user.username }}</p>
                    <form method="post" class="mt-3">
                        {{ comment_form | crispy }}
                        {% csrf_token %}
                        <button type="submit" class="btn btn-info">Post Comment</button>
                    </form>
                    {% else %}
                    <h4>Please <span><a href="{% url 'account_login' %}">Login</a></span> To Join In On The Conversation Above!</h3>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>


{% endblock content %}